<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Vendedor - Gra√ßa Presentes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Cabe√ßalho -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-pink-600">üéÅ Gra√ßa Presentes</h1>
            <p class="text-gray-600">Painel Administrativo - Cadastro de Produtos</p>
        </div>

        <!-- Formul√°rio de Cadastro -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">‚ûï Adicionar Novo Produto</h2>
            
            <form id="produtoForm" class="space-y-6">
                <!-- Informa√ß√µes B√°sicas -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìù Nome do Produto *</label>
                        <input type="text" name="nome" required 
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                               placeholder="Ex: Buqu√™ de Rosas Vermelhas">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìÇ Categoria *</label>
                        <select name="categoria" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            <option value="">Selecione uma categoria</option>
                            <option value="Flores">üå∑ Flores</option>
                            <option value="Doces">üç´ Doces</option>
                            <option value="Pel√∫cias">üß∏ Pel√∫cias</option>
                            <option value="Cosm√©ticos">üíÑ Cosm√©ticos</option>
                            <option value="Kits">üéÅ Kits</option>
                            <option value="Decora√ß√£o">üè† Decora√ß√£o</option>
                            <option value="Joias">üíé Joias</option>
                        </select>
                    </div>
                </div>

                <!-- Pre√ßos -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üí∞ Pre√ßo (R$) *</label>
                        <input type="number" step="0.01" name="preco" required 
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                               placeholder="89.90">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üè∑Ô∏è Pre√ßo Original (opcional)</label>
                        <input type="number" step="0.01" name="preco_original" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                               placeholder="99.90">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üéØ Desconto (%)</label>
                        <input type="number" name="desconto" min="0" max="100" value="0"
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    </div>
                </div>

                <!-- Descri√ß√£o -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÑ Descri√ß√£o do Produto</label>
                    <textarea name="descricao" rows="3" 
                              class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                              placeholder="Descreva o produto detalhadamente..."></textarea>
                </div>

                <!-- Upload de Imagem -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üñºÔ∏è Imagem do Produto</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <input type="file" id="imagemInput" accept="image/*" class="hidden">
                        
                        <div id="uploadArea" class="cursor-pointer">
                            <div class="mx-auto w-12 h-12 text-gray-400 mb-3">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <p class="text-gray-600">Clique para selecionar uma imagem</p>
                            <p class="text-sm text-gray-500 mt-1">PNG, JPG, JPEG at√© 10MB</p>
                        </div>
                        
                        <div id="previewImagem" class="hidden mt-4">
                            <img id="imagemPreview" class="mx-auto max-h-48 rounded-lg shadow-md">
                            <button type="button" onclick="removerImagem()" 
                                    class="mt-2 text-red-600 hover:text-red-800 text-sm font-medium">
                                üóëÔ∏è Remover imagem
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Op√ß√µes -->
                <div class="flex items-center space-x-6">
                    <div class="flex items-center">
                        <input type="checkbox" name="novo" id="novo" class="w-4 h-4 text-pink-600 focus:ring-pink-500">
                        <label for="novo" class="ml-2 text-sm text-gray-700">üÜï Produto Novo</label>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" name="mais_vendido" id="mais_vendido" class="w-4 h-4 text-pink-600 focus:ring-pink-500">
                        <label for="mais_vendido" class="ml-2 text-sm text-gray-700">üî• Mais Vendido</label>
                    </div>
                </div>

                <!-- Bot√£o Submit -->
                <button type="submit" 
                        class="w-full bg-pink-600 text-white py-3 px-6 rounded-lg hover:bg-pink-700 transition duration-200 font-semibold text-lg">
                    üöÄ Cadastrar Produto
                </button>
            </form>
        </div>

        <!-- Lista de Produtos -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">üì¶ Produtos Cadastrados</h2>
                <span id="totalProdutos" class="bg-pink-100 text-pink-800 px-3 py-1 rounded-full text-sm font-medium">0 produtos</span>
            </div>
            
            <div id="listaProdutos" class="space-y-4">
                <!-- Produtos ser√£o carregados aqui -->
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-2">üìù</div>
                    <p>Nenhum produto cadastrado ainda</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let imagemBase64 = null;

        // Gerenciar upload de imagem
        document.getElementById('uploadArea').addEventListener('click', function() {
            document.getElementById('imagemInput').click();
        });

        document.getElementById('imagemInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Verificar tamanho (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('‚ùå A imagem deve ter no m√°ximo 10MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    imagemBase64 = e.target.result;
                    document.getElementById('imagemPreview').src = imagemBase64;
                    document.getElementById('previewImagem').classList.remove('hidden');
                    document.getElementById('uploadArea').classList.add('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        function removerImagem() {
            imagemBase64 = null;
            document.getElementById('imagemInput').value = '';
            document.getElementById('previewImagem').classList.add('hidden');
            document.getElementById('uploadArea').classList.remove('hidden');
        }

        // Cadastrar produto
        document.getElementById('produtoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const button = this.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Cadastrando...';
            button.disabled = true;

            const formData = new FormData(this);
            const produtoData = {
                nome: formData.get('nome'),
                preco: parseFloat(formData.get('preco')),
                preco_original: formData.get('preco_original') ? parseFloat(formData.get('preco_original')) : null,
                categoria: formData.get('categoria'),
                descricao: formData.get('descricao'),
                desconto: parseInt(formData.get('desconto') || 0),
                novo: document.getElementById('novo').checked,
                mais_vendido: document.getElementById('mais_vendido').checked
            };

            try {
                // 1. Cadastrar produto
                const response = await fetch('/api/produtos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(produtoData)
                });

                const result = await response.json();
                
                if (result.success) {
                    // 2. Se tem imagem, fazer upload
                    if (imagemBase64) {
                        await fetch('/api/upload-imagem', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                produto_id: result.produto_id,
                                imagem_base64: imagemBase64
                            })
                        });
                    }

                    alert('‚úÖ Produto cadastrado com sucesso!');
                    this.reset();
                    removerImagem();
                    carregarProdutos();
                } else {
                    alert('‚ùå Erro ao cadastrar produto: ' + result.error);
                }
            } catch (error) {
                alert('‚ùå Erro ao cadastrar produto: ' + error);
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        });

        // Carregar produtos
        async function carregarProdutos() {
            try {
                const response = await fetch('/api/produtos');
                const produtos = await response.json();
                
                document.getElementById('totalProdutos').textContent = `${produtos.length} produtos`;
                
                const lista = document.getElementById('listaProdutos');
                
                if (produtos.length === 0) {
                    lista.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üìù</div>
                            <p>Nenhum produto cadastrado ainda</p>
                        </div>
                    `;
                    return;
                }
                
                lista.innerHTML = produtos.map(produto => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex items-center space-x-4">
                            ${produto.imagem_url ? 
                                `<img src="${produto.imagem_url}" class="w-20 h-20 object-cover rounded-lg">` : 
                                `<div class="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center">
                                    <span class="text-2xl text-gray-400">üì∑</span>
                                </div>`
                            }
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg text-gray-800">${produto.nome}</h3>
                                <p class="text-gray-600">${produto.descricao || 'Sem descri√ß√£o'}</p>
                                <div class="flex items-center space-x-4 mt-2">
                                    <span class="text-pink-600 font-bold">R$ ${produto.preco.toFixed(2)}</span>
                                    <span class="text-sm text-gray-500">${produto.categoria}</span>
                                    ${produto.desconto > 0 ? 
                                        `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">${produto.desconto}% OFF</span>` : ''}
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                ${produto.novo ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Novo</span>' : ''}
                                ${produto.maisVendido ? '<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">Mais Vendido</span>' : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                lista.innerHTML = '<p class="text-red-500 text-center">Erro ao carregar produtos</p>';
            }
        }

        // Carregar produtos ao iniciar
        carregarProdutos();
    </script>
</body>
</html>